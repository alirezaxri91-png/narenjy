/*
Ù†Ø§Ø±Ù†Ø¬ÛŒ â€” Ù†Ø³Ø®Ù‡Ù” Ù†Ù…Ø§ÛŒØ´ÛŒ Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† ÙˆØ¨ (React + Tailwind)

- ÙØ§ÛŒÙ„ ØªÚ©â€ŒØµÙØ­Ù‡â€ŒØ§ÛŒ React: `NarengiApp` Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† export default
- RTL (ÙØ§Ø±Ø³ÛŒ)ØŒ ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ØŒ Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†/ØªØ§Ø±ÛŒÚ©ØŒ Ù„ÛŒØ³Øª Ú†Øª Ù†Ù…ÙˆÙ†Ù‡ØŒ Ú©Ø§Ù…Ù¾ÙˆØ²Ø± Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø±Ø³Ø§Ù„ØŒ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
- Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø§ Tailwind (Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ ÙØ±Ø¶ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ù†Ø¯)
- Ø§Ø² ikonâ€ŒÙ‡Ø§ÛŒ lucide-react Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡Ø› Ø§Ú¯Ø± Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ù†Ø¯Ø§Ø±ÛŒØ¯ `npm i lucide-react` Ù†ØµØ¨ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§ÛŒÙ…Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯.

Ù†Ø­ÙˆÙ‡ Ø§Ø¬Ø±Ø§ (Ø®Ù„Ø§ØµÙ‡):
1. Ù¾Ø±ÙˆÚ˜Ù‡Ù” React Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ `create-react-app` ÛŒØ§ Vite)
2. Tailwind Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯ (Ù…Ø±Ø¬Ø¹ Tailwind)
3. Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯Ø± `src/NarengiApp.jsx` Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ø± `src/main.jsx` ÛŒØ§ `App.jsx` Ø§ÛŒÙ…Ù¾ÙˆØ±Øª Ú©Ù†ÛŒØ¯.
4. `npm start` ÛŒØ§ `pnpm dev` Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯.

ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ù†Ù…Ø§ÛŒØ´ÛŒ Ø§Ø³Øªâ€”Ø¨Ø±Ø§ÛŒ Ø§Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ú©â€ŒØ§Ù†Ø¯ (WebSocket/HTTP + Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª) Ùˆ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ø³Øª.
*/

import React, { useEffect, useState, useRef } from "react";
import { Send, SunMoon, Image as ImageIcon, Smile } from "lucide-react";

export default function NarengiApp() {
  // Ø­Ø§Ù„Øª Ú©Ø§Ø±Ø¨Ø± Ù†Ù…ÙˆÙ†Ù‡
  const [user] = useState({ id: "u1", name: "Ø¹Ù„ÛŒØ±Ø¶Ø§", avatar: "ğŸŸ " });

  // Ú†Øªâ€ŒÙ‡Ø§ â€” Ù‡Ø± Ú†Øª Ø´Ø§Ù…Ù„ id, title, messages[]
  const sample = [
    {
      id: "c1",
      title: "Ø¯ÙˆØ³Øª ØµÙ…ÛŒÙ…ÛŒ",
      messages: [
        { id: 1, from: "u2", text: "Ø³Ù„Ø§Ù…! Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ", time: "10:02" },
        { id: 2, from: "u1", text: "Ø¹Ø§Ù„ÛŒ! Ø¯Ø§Ø±Ù… Ø±ÙˆÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ù†Ø§Ø±Ù†Ø¬ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù… ğŸ˜Š", time: "10:03" },
      ],
    },
    {
      id: "c2",
      title: "Ú¯Ø±ÙˆÙ‡ Ù…Ø¯Ø±Ø³Ù‡",
      messages: [
        { id: 1, from: "u3", text: "Ú©Ø³ÛŒ Ø±ÛŒØ§Ø¶ÛŒ Ø¯Ø§Ø±Ù‡ØŸ", time: "Ø¯ÛŒØ±ÙˆØ²" },
      ],
    },
  ];

  const [conversations, setConversations] = useState(() => {
    try {
      const raw = localStorage.getItem("narengi_convos");
      return raw ? JSON.parse(raw) : sample;
    } catch (e) {
      return sample;
    }
  });

  const [activeId, setActiveId] = useState(conversations[0]?.id ?? null);
  const [draft, setDraft] = useState("");
  const [dark, setDark] = useState(() => localStorage.getItem("narengi_dark") === "1");
  const listRef = useRef(null);

  useEffect(() => {
    localStorage.setItem("narengi_convos", JSON.stringify(conversations));
  }, [conversations]);

  useEffect(() => {
    localStorage.setItem("narengi_dark", dark ? "1" : "0");
    if (dark) document.documentElement.classList.add("dark");
    else document.documentElement.classList.remove("dark");
  }, [dark]);

  const active = conversations.find((c) => c.id === activeId) || conversations[0];

  function sendMessage() {
    if (!draft.trim()) return;
    const newMsg = { id: Date.now(), from: user.id, text: draft.trim(), time: new Date().toLocaleTimeString() };
    setConversations((prev) =>
      prev.map((c) => (c.id === active.id ? { ...c, messages: [...c.messages, newMsg] } : c))
    );
    setDraft("");

    // Ø³Ù…ÙˆÙ„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†: ÙˆÙ‚ØªÛŒ Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ØŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ú©Ù†
    setTimeout(() => scrollToBottom(), 50);
  }

  function scrollToBottom() {
    if (!listRef.current) return;
    listRef.current.scrollTop = listRef.current.scrollHeight;
  }

  function createConversation() {
    const id = "c" + Date.now();
    const newConv = { id, title: "Ú¯ÙØªâ€ŒÙˆÚ¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯", messages: [{ id: 1, from: "u2", text: "Ø³Ù„Ø§Ù…! Ø§ÛŒÙ† Ú†Øª ØªØ§Ø²Ù‡â€ŒØ³.", time: "Ù‡Ù…ÛŒÙ† Ø§Ù„Ø¢Ù†" }] };
    setConversations((s) => [newConv, ...s]);
    setActiveId(id);
  }

  // Ø·Ø±Ø§Ø­ÛŒ ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ Ùˆ RTL
  return (
    <div className="h-screen w-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
      <div className="max-w-6xl mx-auto h-full grid grid-cols-12 gap-4 p-4">
        {/* Ù†ÙˆØ§Ø± Ú©Ù†Ø§Ø±ÛŒ */}
        <aside className="col-span-4 md:col-span-3 lg:col-span-3 bg-white/60 dark:bg-gray-800/60 backdrop-blur-md rounded-2xl p-3 flex flex-col gap-3">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="text-2xl">{user.avatar}</div>
              <div>
                <div className="font-bold">{user.name}</div>
                <div className="text-xs text-gray-500 dark:text-gray-400">Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <button
                title="Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù† / ØªØ§Ø±ÛŒÚ©"
                onClick={() => setDark((d) => !d)}
                className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                <SunMoon size={18} />
              </button>
              <button
                onClick={createConversation}
                className="px-3 py-1 bg-orange-500 text-white rounded-lg shadow-sm hover:brightness-105">
                Ù†Ùˆ +
              </button>
            </div>
          </div>

          <div className="flex-1 overflow-auto">
            <div className="space-y-2">
              {conversations.map((c) => (
                <div
                  key={c.id}
                  onClick={() => setActiveId(c.id)}
                  className={`p-2 rounded-lg cursor-pointer flex items-center justify-between ${c.id === activeId ? "bg-orange-50 dark:bg-orange-900/30 border border-orange-200" : "hover:bg-gray-100 dark:hover:bg-gray-800/40"}`}>
                  <div>
                    <div className="font-medium">{c.title}</div>
                    <div className="text-xs text-gray-500 dark:text-gray-400 truncate w-40">{c.messages[c.messages.length - 1]?.text}</div>
                  </div>
                  <div className="text-xs text-gray-400">{c.messages.length}</div>
                </div>
              ))}
            </div>
          </div>

          <div className="text-xs text-center text-gray-500">Ù†Ø³Ø®Ù‡Ù” Ø¯Ù…Ùˆ â€” Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø±ÙˆØ± ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù†ÛŒ</div>
        </aside>

        {/* Ù¾Ù†Ù„ Ú¯ÙØªÚ¯Ùˆ */}
        <main className="col-span-8 md:col-span-9 lg:col-span-9 bg-white/70 dark:bg-gray-800/60 backdrop-blur-md rounded-2xl p-4 flex flex-col">
          <header className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="text-3xl">ğŸŸ </div>
              <div>
                <div className="font-bold text-lg">{active?.title ?? "Ø§Ù†ØªØ®Ø§Ø¨ ÛŒÚ© Ú¯ÙØªÚ¯Ùˆ"}</div>
                <div className="text-xs text-gray-500 dark:text-gray-400">Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…: {active?.messages?.slice(-1)[0]?.text ?? "â€”"}</div>
              </div>
            </div>
            <div className="text-xs text-gray-500">Ù†Ø§Ø±Ù†Ø¬ÛŒ â€” Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù†</div>
          </header>

          <div ref={listRef} className="flex-1 overflow-auto mt-4 p-3 space-y-3 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-700">
            {active?.messages?.map((m) => {
              const mine = m.from === user.id;
              return (
                <div key={m.id} className={`flex ${mine ? "justify-start" : "justify-end"}`}>
                  <div className={`max-w-[70%] p-3 rounded-2xl ${mine ? "bg-orange-100/90 dark:bg-orange-900/30" : "bg-gray-100 dark:bg-gray-700/60"}`}>
                    <div className="whitespace-pre-wrap">{m.text}</div>
                    <div className="text-xs text-gray-400 mt-1 text-left">{m.time}</div>
                  </div>
                </div>
              );
            })}
          </div>

          {/* Ø³ØªÙˆÙ† Ù¾Ø§ÛŒÛŒÙ†: Ú©Ø§Ù…Ù¾ÙˆØ²Ø± Ù¾ÛŒØ§Ù… */}
          <div className="mt-3 flex items-center gap-2">
            <button title="Ø§Ø³ØªÛŒÚ©Ø±/Ø§ÛŒÙ…ÙˆØ¬ÛŒ" className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/40"><Smile size={18} /></button>
            <button title="Ø§Ø±Ø³Ø§Ù„ ØªØµÙˆÛŒØ±" className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/40"><ImageIcon size={18} /></button>

            <input
              dir="rtl"
              value={draft}
              onChange={(e) => setDraft(e.target.value)}
              onKeyDown={(e) => { if (e.key === "Enter") sendMessage(); }}
              placeholder="Ù¾ÛŒØ§Ù… Ø¨Ù†ÙˆÛŒØ³..."
              className="flex-1 px-3 py-2 rounded-full bg-gray-100 dark:bg-gray-700/50 focus:outline-none" />

            <button
              onClick={sendMessage}
              className="ml-2 px-4 py-2 bg-orange-500 text-white rounded-full flex items-center gap-2 hover:brightness-105">
              Ø§Ø±Ø³Ø§Ù„ <Send size={16} />
            </button>
          </div>
        </main>
      </div>

      {/* Ø§ÙÚ©Øª Ú¯ÙˆØ´Ù‡Ù” ØµÙØ­Ù‡ */}
      <div className="fixed left-4 bottom-6 text-sm text-gray-500">Ù†Ø§Ø±Ù†Ø¬ÛŒ â€” Ø¯Ù…ÙˆÛŒÛŒ Ø§Ø² Ø±Ø§Ø¨Ø· Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† âœ¨</div>
    </div>
  );
}
